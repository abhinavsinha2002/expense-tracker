<div class="groups-container fade-in">
  
  <div class="header-row">
    <h2 class="title">My Groups</h2>
    <button class="create-btn" (click)="showCreateModal = true">
      <mat-icon style="vertical-align: middle; font-size: 20px; height: 20px; width: 20px;">add</mat-icon> 
      New Group
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner-border text-warning" role="status"></div>
    <p class="mt-3">Syncing your groups...</p>
  </div>

  <ng-container *ngIf="!isLoading">
    
    <div class="groups-grid" *ngIf="groups.length > 0">
      
      <div class="group-card" *ngFor="let group of groups" [routerLink]="['/main/groups', group.id]">
        
        <div class="card-bg" [style.background-image]="'url(' + getGroupImage(group.name) + ')'"></div>
        <div class="card-overlay"></div>
        
        <div class="card-content">
          <div>
            <h3 class="group-name">{{ group.name }}</h3>
            <p class="group-desc">{{ group.description || 'No description provided.' }}</p>
          </div>
          
          <div class="card-footer">
            <span class="currency-badge">{{ group.currency || 'INR' }}</span>
            
            <div class="avatars">
              <div class="avatar-circle" 
                   style="background: #dcb14a; color: #000; z-index: 10;" 
                   matTooltip="You">
                   ME
              </div>

              <ng-container *ngFor="let member of getOtherMembers(group.members) | slice:0:3; let i = index">
                 <div class="avatar-circle" 
                      [style.background-color]="getAvatarColor(member.fullName)"
                      [style.z-index]="9 - i"
                      [matTooltip]="member.fullName">
                   {{ getInitials(member.fullName) }}
                 </div>
              </ng-container>

              <div class="avatar-circle" 
                   style="background: #333; z-index: 0;" 
                   *ngIf="getOtherMembers(group.members).length > 3">
                +{{ getOtherMembers(group.members).length - 3 }}
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div *ngIf="groups.length === 0" class="empty-state">
       <mat-icon style="font-size: 5rem; width: 5rem; height: 5rem; opacity: 0.5;">groups</mat-icon>
       <p class="mt-3" style="font-size: 1.1rem;">You don't have any groups yet.</p>
       <p style="font-size: 0.9rem;">Create one to start tracking expenses.</p>
    </div>

  </ng-container>

</div>

<div class="modal-overlay" *ngIf="showCreateModal">
  <div class="modal-card fade-in">
    
    <div class="modal-header-row mb-4">
      <h3>Create a Group</h3>
      <button class="close-icon-btn" (click)="showCreateModal = false">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="mb-4">
      <input type="text" [(ngModel)]="newGroup.name" placeholder="Group Name (e.g. Goa Trip)" class="form-control form-control-lg">
    </div>
    <div class="mb-4">
      <input type="text" [(ngModel)]="newGroup.description" placeholder="Short Description" class="form-control form-control-lg">
    </div>
    <div class="mb-5">
      <select [(ngModel)]="newGroup.currency" class="form-control form-control-lg custom-select">
        <option value="INR">INR (₹)</option>
        <option value="USD">USD ($)</option>
        <option value="EUR">EUR (€)</option>
      </select>
    </div>
    
    <div class="d-flex gap-3">
      <button class="create-btn flex-grow-1" (click)="createGroup()" [disabled]="isLoading" style="padding: 14px 24px; font-size: 1.1rem;">
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
        Create Group
      </button>
    </div>
  </div>
</div>